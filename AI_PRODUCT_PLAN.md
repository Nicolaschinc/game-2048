# AI Game Companion for 2048 - Product Requirements Document (PRD)

## 1. 产品定义 (Product Definition)
打造一个既懂战术又懂情感的“AI 游戏搭子”。它旨在通过混合模式（本地算法 + 云端 LLM）实现低成本、高互动的游戏体验，帮助用户在冲击 4096 的同时享受过程的乐趣。

## 2. 核心功能模块 (Core Features)

### 2.1 🧠 战术大脑 (Tactical Brain) —— 负责“赢”
*   **定位**：本地化、低延迟、高可靠的算力担当。
*   **实现方式**：VITE_DEEPSEEK_API_KEY=sk-你的API-Key
VITE_DEEPSEEK_BASE_URL=https://api.deepseek.com基于 JavaScript 实现的 Expectimax 搜索算法（深度 3-4 层）。
*   **功能**：
    *   **实时决策**：每一步操作后，毫秒级计算出胜率最高的下一步（Up/Down/Left/Right）。
    *   **危险预警**：当用户准备进行一步可能导致“死局”的操作时，UI 上给予提示。
    *   **零成本**：纯前端运行，无需 API 调用。

### 2.2 💬 情感嘴替 (Emotional Soul) —— 负责“好玩”
*   **定位**：云端、高情商、个性化的嘴替。
*   **实现方式**：混合模式（Hybrid Mode）。
    *   **Level 1 (基础)**：本地规则引擎 + 预设语料库（已实现）。
    *   **Level 2 (进阶)**：事件驱动触发 LLM API (OpenAI/DeepSeek/Claude) 生成动态评论。
*   **功能**：
    *   **局势吐槽**：根据顺风/逆风局势发表个性化评论（如嘲讽、鼓励、幽默）。
    *   **主动介入**：长时间无操作（Idle > 10s）或连续得分时主动搭话。
    *   **成本控制**：
        *   **Debounce (防抖)**：避免频繁请求。
        *   **Cooldown (冷却)**：两次 API 调用至少间隔 15s。
        *   **降级策略**：网络/额度问题时自动降级回本地语料。

### 2.3 🎨 交互界面 (UI/UX)
*   **AI 助手面板**：
    *   悬浮于游戏界面，包含 AI 头像（表情变化）、对话气泡、建议指示。
    *   支持 **折叠/展开** 及 **完全关闭**。
*   **视觉反馈**：
    *   建议方向的高亮提示。
    *   AI 思考状态的动画。

## 3. 实施步骤与节奏 (Implementation Roadmap)

### Phase 1: 基础架构与本地智能 (MVP) - ✅ 已完成
- [x] **UI 改造**：实现 `AIAssistant` 组件，支持折叠与开关。
- [x] **接入本地算法**：移植 Expectimax 算法 (`src/ai/engine.js`)，实现毫秒级战术建议。
- [x] **规则引擎评论**：建立本地语料库 (`src/ai/localComments.js`)，实现基础情感反馈。
- [x] **主逻辑集成**：在 `App.jsx` 中集成 AI 状态与游戏循环，实现 Debounce 机制。

### Phase 2: 接入云端大脑 (Cloud Integration) - 🚧 待规划
- [ ] **API 封装**：编写 LLM Client，处理 API 鉴权与流式响应。
- [ ] **Prompt Engineering**：设计系统提示词，定义 AI 人设（毒舌/温柔/中二）。
- [ ] **上下文压缩**：优化 Grid 状态传输格式，减少 Token 消耗。

### Phase 3: 体验打磨 (Polish) - 📅 未来规划
- [ ] **多性格切换**：用户可选择不同的 AI 人格。
- [ ] **流式输出**：打字机效果，增强真实感。
- [ ] **数据埋点**：分析 AI 建议的采纳率与胜率提升。

## 4. 风险评估 (Risk Assessment)

| 风险点 | 影响 | 应对方案 |
| :--- | :--- | :--- |
| **API 成本过高** | 资金消耗快 | 严格限制调用频率；非关键步数使用本地语料兜底。 |
| **响应延迟** | 破坏游戏节奏 | UI 采用异步非阻塞设计；AI 思考时不阻塞用户操作。 |
| **幻觉 (Hallucination)** | 错误建议 | 战术建议强依赖本地算法（绝对理性），LLM 仅负责情感陪聊。 |
| **用户干扰** | 体验下降 | 提供显眼的“静音/关闭”按钮；AI 话痨程度可调。 |
